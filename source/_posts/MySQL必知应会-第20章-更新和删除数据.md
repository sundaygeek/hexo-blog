---
title: MySQL必知应会-第20章-更新和删除数据
date: 2018-04-13 18:06:19
tags:
 - mysql
 - 数据库
categories:
 - mysql
 - 数据库
---

更新和删除数据本章介绍如何利用UPDATE和DELETE语句进一步操纵表数据。20.1 更新数据为了更新（修改）表中的数据，可使用UPDATE语句。可采用两种方式使用UPDATE：? 更新表中特定行；? 更新表中所有行。下面分别对它们进行介绍。不要省略WHERE子句 在使用UPDATE时一定要注意细心。因为稍不注意，就会更新表中所有行。在使用这条语句前，请完整地阅读本节。UPDATE与安全 可以限制和控制UPDATE语句的使用，更多内容请参见第28章。UPDATE语句非常容易使用，甚至可以说是太容易使用了。基本的UPDATE语句由3部分组成，分别是：? 要更新的表；? 列名和它们的新值；第 20 章140 第 20 章 更新和删除数据? 确定要更新行的过滤条件。举一个简单例子。客户10005现在有了电子邮件地址，因此他的记录需要更新，语句如下：UPDATE语句总是以要更新的表的名字开始。在此例子中，要更新的表的名字为customers。 SET命令用来将新值赋给被更新的列。如这里所示， SET子句设置cust_email列为指定的值：UPDATE语句以WHERE子句结束，它告诉MySQL更新哪一行。没有WHERE子句， MySQL将会用这个电子邮件地址更新customers表中所有行，这不是我们所希望的。更新多个列的语法稍有不同：在更新多个列时，只需要使用单个SET命令，每个“列=值”对之间用逗号分隔（最后一列之后不用逗号）。在此例子中，更新客户10005的cust_name和cust_email列。在UPDATE语句中使用子查询 UPDATE语句中可以使用子查询，使得能用SELECT语句检索出的数据更新列数据。关于子查询及使用的更多内容，请参阅第14章。IGNORE关键字 如果用UPDATE语句更新多行，并且在更新这些行中的一行或多行时出一个现错误，则整个UPDATE操作被取消（错误发生前更新的所有行被恢复到它们原来的值）。为即使是发生错误，也继续进行更新，可使用IGNORE关键字，如下所示：UPDATE IGNORE customers…输入输入18718820.2 删除数据 141为了删除某个列的值，可设置它为NULL（假如表定义允许NULL值）。如下进行：其中NULL用来去除cust_email列中的值。20.2 删除数据为了从一个表中删除（去掉）数据，使用DELETE语句。可以两种方式使用DELETE：? 从表中删除特定的行；? 从表中删除所有行。下面分别对它们进行介绍。不要省略WHERE子句 在使用DELETE时一定要注意细心。因为稍不注意，就会错误地删除表中所有行。在使用这条语句前，请完整地阅读本节。DELETE与安全 可以限制和控制DELETE语句的使用，更多内容请参见第28章。前面说过， UPDATE非常容易使用，而DELETE更容易使用。下面的语句从customers表中删除一行：这条语句很容易理解。 DELETE FROM要求指定从中删除数据的表名。WHERE子句过滤要删除的行。在这个例子中，只删除客户10006。如果省略WHERE子句，它将删除表中每个客户。DELETE不需要列名或通配符。 DELETE删除整行而不是删除列。为了删除指定的列，请使用UPDATE语句。输入输入189142 第 20 章 更新和删除数据删除表的内容而不是表 DELETE语句从表中删除行，甚至是删除表中所有行。但是， DELETE不删除表本身。更快的删除 如果想从表中删除所有行，不要使用DELETE。可使用TRUNCATE TABLE语句，它完成相同的工作，但速度更快（ TRUNCATE实际是删除原来的表并重新创建一个表，而不是逐行删除表中的数据）。20.3 更新和删除的指导原则前一节中使用的UPDATE和DELETE语句全都具有WHERE子句，这样做的理由很充分。如果省略了WHERE子句，则UPDATE或DELETE将被应用到表中所有的行。换句话说，如果执行UPDATE而不带WHERE子句，则表中每个行都将用新值更新。类似地，如果执行DELETE语句而不带WHERE子句，表的所有数据都将被删除。下面是许多SQL程序员使用UPDATE或DELETE时所遵循的习惯。? 除非确实打算更新和删除每一行，否则绝对不要使用不带WHERE子句的UPDATE或DELETE语句。? 保证每个表都有主键（如果忘记这个内容，请参阅第15章），尽可能像WHERE子句那样使用它（可以指定各主键、多个值或值的范围）。? 在对UPDATE或DELETE语句使用WHERE子句前，应该先用SELECT进行测试，保证它过滤的是正确的记录，以防编写的WHERE子句不正确。? 使用强制实施引用完整性的数据库（关于这个内容，请参阅第15章），这样MySQL将不允许删除具有与其他表相关联的数据的行。小心使用 MySQL没有撤销（ undo）按钮。应该非常小心地使用UPDATE和DELETE，否则你会发现自己更新或删除了错误的数据。19020.4 小结 14320.4 小结我们在本章中学习了如何使用UPDATE和DELETE语句处理表中的数据。我们学习了这些语句的语法，知道了它们固有的危险性。本章中还讲解了为什么WHERE子句对UPDATE和DELETE语句很重要，并且给出了应该遵循的一些指导原则，以保证数据的安全。 191创建和操纵表本章讲授表的创建、更改和删除的基本知识。21.1 创建表MySQL不仅用于表数据操纵，而且还可以用来执行数据库和表的所有操作，包括表本身的创建和处理。一般有两种创建表的方法：? 使用具有交互式创建和管理表的工具（如第2章讨论的工具）；? 表也可以直接用MySQL语句操纵。为了用程序创建表，可使用SQL的CREATE TABLE语句。值得注意的是，在使用交互式工具时，实际上使用的是MySQL语句。但是，这些语句不是用户编写的，界面工具会自动生成并执行相应的MySQL语句（更改现有表时也是这样）。另外的例子 关于表创建脚本的另外例子，请参阅本书中用来创建样例表的代码。21.1.1 表创建基础为利用CREATE TABLE创建表，必须给出下列信息：? 新表的名字，在关键字CREATE TABLE之后给出；? 表列的名字和定义，用逗号分隔。CREATE TABLE语句也可能会包括其他关键字或选项，但至少要包括表的名字和列的细节。下面的MySQL语句创建本书中所用的customers表：